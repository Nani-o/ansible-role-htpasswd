---
- hosts: container
  vars:
    htpasswd_files:
      - path: /tmp/test/htpasswd1
        create_folder: yes
        owner: nobody
        group: nobody
        mode: "0444"
        users:
          - name: user1
            password: password1
          - name: user2
            password: password2
      - path: /tmp/htpasswd2
        users:
          - name: user
            pasword: secure
  roles:
    - role-to-test
  post_tasks:
    - name: Check passwords
      command: htpasswd -vb "{{ item.0.path }}" "{{ item.1.name }}" "{{ item.1.password }}"
      with_subelements:
        - "{{ htpasswd_files }}"
        - users
